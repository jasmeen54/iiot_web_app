<!DOCTYPE html>
<html>
<head>
    <title>Sensor Data</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <h1>Sensor Data</h1>
    <div id="chartContainer"></div>

    <script>
        function fetchDataAndUpdateCharts() {
            fetch('/data')
                .then(response => response.json())
                .then(sensorData => {
                    if (typeof sensorData === 'object' && sensorData !== null) {
                        // Iterate over each sensor device
                        Object.keys(sensorData).forEach(function(sensorName) {
                            var sensor = sensorData[sensorName];
                            var labels = [];
                            var values = [];

                            // Prepare data for the chart
                            sensor.data.forEach(function(dataItem) {
                                labels.push(dataItem.timestamp); // X-axis

                                // Extract the numerical part of the value
                                var numericalValue = parseFloat(dataItem.value);
                                values.push(numericalValue); // Y-axis
                            });

                            // Create or update the chart
                            var canvasId = 'chart_' + sensorName.replace(/\s+/g, '_');
                            var ctx = document.getElementById(canvasId);
                            if (!ctx) {
                                // Create a container for the chart
                                var container = document.createElement('div');
                                container.setAttribute('class', 'chart-container');
                                document.getElementById('chartContainer').appendChild(container);

                                // Create canvas for the chart
                                var canvasElement = document.createElement('canvas');
                                canvasElement.setAttribute('id', canvasId);
                                container.appendChild(canvasElement);
                                ctx = canvasElement.getContext('2d');
                            }

                            // Update the chart data
                            new Chart(ctx, {
                                type: 'line',
                                data: {
                                    labels: labels,
                                    datasets: [{
                                        label: sensorName,
                                        data: values,
                                        backgroundColor: 'rgba(255, 99, 132, 0.2)',
                                        borderColor: 'rgba(255, 99, 132, 1)',
                                        borderWidth: 1
                                    }]
                                },
                                options: {
                                    scales: {
                                        y: {
                                            beginAtZero: true
                                        }
                                    }
                                }
                            });
                        });
                    }
                })
                .catch(error => console.error('Error fetching data:', error));
        }

        // Fetch data and update charts every 5 minutes
        fetchDataAndUpdateCharts();
        setInterval(fetchDataAndUpdateCharts, 300000); // 5 minutes in milliseconds
    </script>
</body>
</html>
















